<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SkyGaze — Interactive Starfield</title>
  <style>
    :root{
      --bg:#010214;
      --panel: rgba(255,255,255,0.04);
      --accent: #8ab4ff;
      --muted: rgba(255,255,255,0.6);
      --glass: rgba(255,255,255,0.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background: radial-gradient(ellipse at bottom, #03102a 0%, var(--bg) 60%);color:#e9f0ff}

    /* Layout */
    .app{display:grid;grid-template-columns:1fr 320px;gap:18px;height:100vh;padding:18px}
    .canvas-wrap{position:relative;border-radius:14px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
    canvas{display:block;width:100%;height:100%}

    /* Side panel */
    .panel{width:320px;padding:14px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));backdrop-filter: blur(6px);box-shadow:inset 0 1px 0 rgba(255,255,255,0.02)}
    h1{margin:4px 0 8px;font-size:18px}
    .controls{display:flex;flex-direction:column;gap:10px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type=range]{width:100%}
    .row{display:flex;gap:8px}
    .btn{padding:8px 10px;border-radius:8px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--muted);font-size:13px}
    .btn.active{background:linear-gradient(90deg,var(--accent),#7fffd4);color:#001}
    .search{display:flex;gap:8px}
    .search input{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    .legend{margin-top:12px;font-size:13px;color:var(--muted)}

    /* Info bubble */
    .info{position:absolute;left:14px;bottom:14px;padding:10px;border-radius:10px;background:var(--panel);backdrop-filter: blur(6px);max-width:320px;font-size:13px}
    .small{font-size:12px;color:var(--muted)}

    /* Responsive */
    @media (max-width:900px){
      .app{grid-template-columns:1fr;grid-template-rows:1fr auto}
      .panel{width:100%;display:flex;overflow:auto}
      .info{left:14px;right:14px}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="canvas-wrap">
      <canvas id="sky"></canvas>

      <div class="info" id="info">
        <div><strong>SkyGaze</strong> — interactive sky simulation</div>
        <div class="small">Click a star or constellation to inspect. Use the controls to change time, toggle constellations, and run a meteor shower.</div>
      </div>
    </div>

    <aside class="panel">
      <h1>SkyGaze Controls</h1>
      <div class="controls">
        <div>
          <label>Time of night: <span id="timeLabel">22:00</span></label>
          <input id="time" type="range" min="0" max="24" step="0.1" value="22">
        </div>

        <div>
          <label>Star density</label>
          <input id="density" type="range" min="0" max="1" step="0.01" value="0.45">
        </div>

        <div class="row">
          <button class="btn" id="toggleConst">Constellations</button>
          <button class="btn" id="toggleLabels">Labels</button>
          <button class="btn" id="meteorBtn">Meteor Shower</button>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <div style="flex:1">
            <label>Zoom</label>
            <input id="zoom" type="range" min="0.5" max="2.5" step="0.01" value="1">
          </div>
        </div>

        <div class="search">
          <input id="search" placeholder="Search constellation or star (e.g., Orion)" />
          <button class="btn" id="go">Go</button>
        </div>

        <div class="legend">
          <div><strong>Quick tips</strong></div>
          <ul style="margin:6px 0 0 18px">
            <li>Use Time slider to rotate the sky (sidereal approximation).</li>
            <li>Click a star to show name + magnitude.</li>
            <li>Try Meteor Shower for random streaks.</li>
          </ul>
        </div>

      </div>
    </aside>
  </div>

  <script>
  // SkyGaze — a single-file interactive starfield
  (function(){
    const canvas = document.getElementById('sky');
    const ctx = canvas.getContext('2d');
    let W = canvas.width = canvas.clientWidth;
    let H = canvas.height = canvas.clientHeight;
    const stars = [];
    const meteors = [];
    let last = performance.now();

    // Simple constellation data (screen-space layout anchors)
    const CONSTELLATIONS = [
      {name:'Orion', lines:[[0,1],[1,2],[2,3],[0,4],[4,5]], points:[{x:0.45,y:0.42,name:'Betelgeuse'},{x:0.5,y:0.46,name:'Bellatrix'},{x:0.55,y:0.5,name:'Rigel'},{x:0.57,y:0.44,name:'Saiph'},{x:0.48,y:0.52,name:'Alnitak'},{x:0.52,y:0.53,name:'Alnilam'}]},
      {name:'Big Dipper', lines:[[0,1],[1,2],[2,3],[3,4],[4,5]], points:[{x:0.2,y:0.28,name:'Dubhe'},{x:0.24,y:0.31,name:'Merak'},{x:0.29,y:0.34,name:'Phecda'},{x:0.34,y:0.38,name:'Megrez'},{x:0.39,y:0.44,name:'Alioth'},{x:0.45,y:0.5,name:'Mizar'}]},
      {name:'Cassiopeia', lines:[[0,1],[1,2],[2,3],[3,4]], points:[{x:0.8,y:0.22,name:'Schedar'},{x:0.73,y:0.3,name:'Caph'},{x:0.68,y:0.26,name:'Gamma Cas'},{x:0.62,y:0.32,name:'Ruchbah'},{x:0.58,y:0.28,name:'Segin'}]}
    ];

    // Utility
    function resize(){
      W = canvas.width = canvas.clientWidth;
      H = canvas.height = canvas.clientHeight;
    }
    window.addEventListener('resize', resize);

    // UI elements
    const timeSlider = document.getElementById('time');
    const timeLabel = document.getElementById('timeLabel');
    const density = document.getElementById('density');
    const meteorBtn = document.getElementById('meteorBtn');
    const toggleConst = document.getElementById('toggleConst');
    const toggleLabels = document.getElementById('toggleLabels');
    const zoomEl = document.getElementById('zoom');
    const search = document.getElementById('search');
    const go = document.getElementById('go');

    let showConst = false;
    let showLabels = false;
    let meteorActive = false;
    let zoom = +zoomEl.value;

    toggleConst.addEventListener('click',()=>{showConst=!showConst; toggleConst.classList.toggle('active',showConst)});
    toggleLabels.addEventListener('click',()=>{showLabels=!showLabels; toggleLabels.classList.toggle('active',showLabels)});
    meteorBtn.addEventListener('click',()=>{meteorActive=!meteorActive; meteorBtn.classList.toggle('active',meteorActive)});
    zoomEl.addEventListener('input',()=>{zoom=+zoomEl.value});

    timeSlider.addEventListener('input',()=>{timeLabel.textContent = formatTime(+timeSlider.value)});
    function formatTime(v){
      const h = Math.floor(v%24).toString().padStart(2,'0');
      const m = Math.round((v%1)*60).toString().padStart(2,'0');
      return `${h}:${m}`;
    }

    // Star generation
    function generateStars(count){
      stars.length = 0;
      for(let i=0;i<count;i++){
        const x = Math.random()*W;
        const y = Math.random()*H;
        const mag = Math.pow(Math.random(), 2)*2.5 + 0.1; // smaller = brighter
        stars.push({x,y,mag,twinkle:Math.random()*Math.PI*2,type:'star'});
      }
    }

    function spawnMeteor(){
      const x = Math.random()*W;
      const y = Math.random()*H*0.5;
      meteors.push({x,y, vx: -6 - Math.random()*6, vy: 3+Math.random()*4, life: 0, max: 80});
      if(meteors.length>8) meteors.shift();
    }

    // click detection
    canvas.addEventListener('click',(e)=>{
      const rect = canvas.getBoundingClientRect();
      const mx = (e.clientX-rect.left);
      const my = (e.clientY-rect.top);
      // find nearest star
      let best=null; let bd=30;
      for(const s of stars){
        const dx = s.x-mx; const dy = s.y-my; const d = Math.hypot(dx,dy);
        if(d<bd){bd=d;best=s}
      }
      if(best){
        showInfo(`Star — magnitude ${best.mag.toFixed(2)}`);
      }
    });

    function showInfo(text){
      const info = document.getElementById('info');
      info.innerHTML = `<strong>SkyGaze</strong><div class=small style="margin-top:6px">${text}</div>`;
      setTimeout(()=>{info.innerHTML = `<strong>SkyGaze</strong><div class="small">Click a star or constellation to inspect. Use the controls to change time, toggle constellations, and run a meteor shower.</div>`},4000);
    }

    // Search
    go.addEventListener('click',()=>{const q = search.value.trim().toLowerCase(); if(!q) return; let found=false; for(const c of CONSTELLATIONS){ if(c.name.toLowerCase().includes(q)){ // center view on first point
        const p = c.points[0]; // relative
        focusPoint(p.x*W, p.y*H, `Constellation: ${c.name}`); found=true; break;} }
      if(!found) showInfo('No matching constellation found');
    });

    function focusPoint(x,y,msg){
      // subtle pan and zoom effect: just show message and pulse nearby stars
      for(const s of stars){
        const d = Math.hypot(s.x-x,s.y-y);
        s._pulse = Math.max(0, 60 - d)/60;
      }
      showInfo(msg);
      setTimeout(()=>{for(const s of stars) s._pulse=0},1500);
    }

    // Rendering
    function draw(now){
      const dt = Math.min(40, now - last); last=now;
      ctx.clearRect(0,0,W,H);

      // background subtle gradient
      const g = ctx.createLinearGradient(0,0,0,H);
      g.addColorStop(0,'rgba(3,16,42,0.8)');
      g.addColorStop(1,'rgba(0,3,10,0.6)');
      ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

      // compute rotation based on time control
      const t = (+timeSlider.value)/24;
      const rotation = (t-0.5)*Math.PI*2; // simple rotation

      // draw stars
      for(const s of stars){
        // apply rotation around center
        const cx = W/2, cy = H/2;
        const rx = (s.x-cx)*Math.cos(rotation) - (s.y-cy)*Math.sin(rotation) + cx;
        const ry = (s.x-cx)*Math.sin(rotation) + (s.y-cy)*Math.cos(rotation) + cy;

        const baseRadius = Math.max(0.2, (1.6 - s.mag)*0.9);
        const tw = 0.6 + Math.sin((now/600)+s.twinkle)*0.4;
        const pulse = s._pulse || 0;
        const r = (baseRadius*tw + pulse*2) * zoom;

        // glow
        const grad = ctx.createRadialGradient(rx,ry,r*0.2,rx,ry,r*2);
        grad.addColorStop(0,'rgba(255,255,255,0.95)');
        grad.addColorStop(0.4,'rgba(166,196,255,0.5)');
        grad.addColorStop(1,'rgba(8,16,35,0)');
        ctx.fillStyle = grad;
        ctx.beginPath(); ctx.arc(rx,ry,r*1.8,0,Math.PI*2); ctx.fill();

        // center
        ctx.fillStyle = 'white';
        ctx.beginPath(); ctx.arc(rx,ry,Math.max(0.3,r*0.45),0,Math.PI*2); ctx.fill();
      }

      // constellations
      if(showConst){
        ctx.lineWidth=1.2;
        ctx.strokeStyle='rgba(140,180,255,0.8)';
        for(const c of CONSTELLATIONS){
          // draw points transformed
          const pts = c.points.map(p=>({x:p.x*W,y:p.y*H})).map(p=>{
            const cx=W/2, cy=H/2; return {x:(p.x-cx)*Math.cos(rotation)-(p.y-cy)*Math.sin(rotation)+cx, y:(p.x-cx)*Math.sin(rotation)+(p.y-cy)*Math.cos(rotation)+cy}
          });
          ctx.beginPath();
          for(const l of c.lines){
            const a = pts[l[0]]; const b=pts[l[1]];
            ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y);
          }
          ctx.stroke();

          if(showLabels){
            ctx.font = '12px system-ui, Arial'; ctx.fillStyle = 'rgba(200,220,255,0.9)';
            ctx.fillText(c.name, pts[Math.floor(pts.length/2)].x + 6, pts[Math.floor(pts.length/2)].y - 6);
          }
        }
      }

      // meteors
      if(meteorActive && Math.random()<0.05) spawnMeteor();
      for(let i=meteors.length-1;i>=0;i--){
        const m = meteors[i];
        m.x += m.vx; m.y += m.vy; m.life++;
        const alpha = 1 - m.life/m.max;
        ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
        ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(m.x, m.y); ctx.lineTo(m.x - m.vx*4, m.y - m.vy*4); ctx.stroke();
        if(m.life>m.max) meteors.splice(i,1);
      }

      requestAnimationFrame(draw);
    }

    // initial population
    function populate(){
      const target = Math.round(1200 * (+density.value));
      generateStars(target);
    }
    density.addEventListener('input',populate);

    // start
    resize(); populate(); requestAnimationFrame((n)=>{last=n; draw(n)});

    // small keyboard shortcuts
    window.addEventListener('keydown',(e)=>{
      if(e.key==='c') { showConst=!showConst; toggleConst.classList.toggle('active',showConst) }
      if(e.key==='l') { showLabels=!showLabels; toggleLabels.classList.toggle('active',showLabels) }
      if(e.key==='m') { meteorActive=!meteorActive; meteorBtn.classList.toggle('active',meteorActive) }
    });

    // gentle initial animation: alternate background stars slowly
    setInterval(()=>{
      for(const s of stars) s.twinkle += 0.4*Math.random();
    },700);

  })();
  </script>
</body>
</html>
